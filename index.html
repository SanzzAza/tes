<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DramaBox - Vercel Edition</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root {
            --primary: #667eea;
            --secondary: #764ba2;
            --dark: #2c3e50;
            --danger: #e74c3c;
        }
        body {
            font-family: 'Segoe UI', Tahoma, sans-serif;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 24px;
            padding: 35px;
            box-shadow: 0 25px 80px rgba(0,0,0,0.3);
        }
        /* HEADER */
        header { text-align: center; margin-bottom: 40px; padding-bottom: 30px; border-bottom: 4px solid var(--primary); }
        .logo { font-size: 4em; margin-bottom: 10px; }
        h1 { color: var(--primary); font-size: 3em; margin-bottom: 10px; }
        .subtitle { color: #666; font-size: 1.2em; }
        
        /* SEARCH */
        .search-box { display: flex; gap: 15px; margin-bottom: 25px; max-width: 700px; margin-left: auto; margin-right: auto; }
        .search-box input {
            flex: 1; padding: 18px 25px; border: 3px solid var(--primary); border-radius: 50px; font-size: 17px; outline: none;
        }
        .search-box button {
            padding: 18px 40px; background: linear-gradient(135deg, var(--primary), var(--secondary)); color: white; border: none; border-radius: 50px; cursor: pointer; font-weight: bold; transition: transform 0.2s;
        }
        .search-box button:hover { transform: scale(1.05); }
        
        /* TABS */
        .tabs { display: flex; gap: 12px; margin-bottom: 35px; overflow-x: auto; padding-bottom: 10px; }
        .tab-btn {
            padding: 15px 28px; background: #f5f5f5; border: none; border-radius: 14px; cursor: pointer; font-weight: 600; white-space: nowrap; transition: all 0.3s;
        }
        .tab-btn.active { background: linear-gradient(135deg, var(--primary), var(--secondary)); color: white; box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4); }
        
        /* LOADING */
        .loading { text-align: center; padding: 80px; color: var(--primary); }
        .spinner {
            border: 5px solid #f3f3f3; border-top: 5px solid var(--primary); border-radius: 50%; width: 60px; height: 60px; animation: spin 1s linear infinite; margin: 0 auto 20px;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        /* GRID */
        .drama-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 25px; }
        .drama-card {
            background: white; border-radius: 18px; overflow: hidden; box-shadow: 0 8px 25px rgba(0,0,0,0.1); cursor: pointer; transition: transform 0.3s;
        }
        .drama-card:hover { transform: translateY(-12px); box-shadow: 0 20px 50px rgba(0,0,0,0.2); }
        .drama-card img { width: 100%; height: 300px; object-fit: cover; }
        .drama-info { padding: 18px; }
        .drama-title { font-weight: bold; font-size: 15px; margin-bottom: 10px; color: var(--dark); min-height: 45px; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
        .drama-meta { font-size: 13px; color: #666; margin-bottom: 6px; }
        .badge { display: inline-block; padding: 5px 12px; background: var(--primary); color: white; border-radius: 8px; font-size: 11px; font-weight: bold; margin-top: 5px; }
        .badge.vip { background: linear-gradient(135deg, #f093fb, #f5576c); }
        .badge.hot { background: linear-gradient(135deg, #FA8BFF, #2BD2FF); }

        /* MODAL */
        .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.92); z-index: 9999; overflow-y: auto; padding: 20px; animation: fadeIn 0.3s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .modal-content { max-width: 1000px; margin: 50px auto; background: white; border-radius: 24px; overflow: hidden; position: relative; }
        .close-btn { position: absolute; top: 20px; right: 20px; background: white; border: none; width: 50px; height: 50px; border-radius: 50%; font-size: 30px; cursor: pointer; z-index: 10; box-shadow: 0 5px 20px rgba(0,0,0,0.3); }
        .close-btn:hover { background: var(--danger); color: white; transform: rotate(90deg); }
        .detail-header { height: 450px; background-size: cover; background-position: center; position: relative; }
        .detail-overlay { position: absolute; bottom: 0; left: 0; right: 0; padding: 50px; background: linear-gradient(to top, rgba(0,0,0,0.95), transparent); color: white; }
        .detail-title { font-size: 2.5em; margin-bottom: 15px; text-shadow: 2px 2px 8px rgba(0,0,0,0.8); }
        .detail-stats { display: flex; gap: 18px; flex-wrap: wrap; margin-top: 15px; }
        .stat-item { background: rgba(255,255,255,0.2); padding: 10px 20px; border-radius: 10px; font-size: 14px; backdrop-filter: blur(10px); }
        .detail-body { padding: 40px; }
        .video-container { display: none; margin-bottom: 30px; }
        .video-player { width: 100%; height: 500px; background: #000; border-radius: 16px; overflow: hidden; }
        .video-player iframe { width: 100%; height: 100%; border: none; }
        .section-title { font-size: 1.5em; margin: 25px 0 15px; color: var(--dark); }
        .info-box { background: #f8f9fa; padding: 22px; border-radius: 14px; margin-bottom: 22px; border-left: 5px solid var(--primary); }
        .info-label { font-weight: bold; color: var(--primary); margin-bottom: 10px; }
        .info-value { color: #555; line-height: 1.8; }
        .episode-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(85px, 1fr)); gap: 12px; margin-top: 20px; }
        .episode-btn { padding: 15px; background: #f5f5f5; border: 3px solid #ddd; border-radius: 12px; cursor: pointer; font-weight: bold; font-size: 14px; transition: all 0.3s; }
        .episode-btn:hover, .episode-btn.active { background: linear-gradient(135deg, var(--primary), var(--secondary)); color: white; border-color: var(--primary); }

        @media (max-width: 768px) {
            h1 { font-size: 2em; }
            .drama-grid { grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); }
            .search-box { flex-direction: column; }
            .video-player { height: 280px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">üé¨</div>
            <h1>DramaBox</h1>
            <p class="subtitle">Nonton Drama China Subtitle Indonesia - Gratis & Lengkap</p>
        </header>

        <div class="search-box">
            <input type="text" id="searchInput" placeholder="Cari drama favorit kamu...">
            <button onclick="searchDrama()">üîç Cari</button>
        </div>

        <div class="tabs">
            <button class="tab-btn active" onclick="loadCategory('foryou', this)">üíù For You</button>
            <button class="tab-btn" onclick="loadCategory('trending', this)">üî• Trending</button>
            <button class="tab-btn" onclick="loadCategory('latest', this)">üÜï Latest</button>
            <button class="tab-btn" onclick="loadCategory('vip', this)">üëë VIP</button>
            <button class="tab-btn" onclick="loadCategory('dubbed', this)">üéôÔ∏è Dubbed</button>
            <button class="tab-btn" onclick="loadCategory('random', this)">üé≤ Random</button>
        </div>

        <div id="content">
            <div class="loading">
                <div class="spinner"></div>
                <p>Memuat drama...</p>
            </div>
        </div>
    </div>

    <div class="modal" id="modal">
        <div class="modal-content" id="modalContent"></div>
    </div>

    <script>
        // =============================================
        // ‚öôÔ∏è CONFIGURATION - Relative Path for Vercel
        // =============================================
        // Gunakan '/api' karena backend ada di api/index.js
        const API_BASE = '/api';
        
        document.addEventListener('DOMContentLoaded', () => {
            loadCategory('foryou');
        });

        document.getElementById('searchInput').addEventListener('keypress', e => {
            if (e.key === 'Enter') searchDrama();
        });

        async function loadCategory(category, btn = null) {
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            if (btn) btn.classList.add('active');
            showLoading();

            try {
                const res = await fetch(`${API_BASE}/${category}`);
                const data = await res.json();
                
                const dramas = data.data || data;
                if (Array.isArray(dramas) && dramas.length > 0) {
                    displayDramas(dramas);
                } else {
                    showEmpty();
                }
            } catch (e) {
                showError('Gagal memuat: ' + e.message);
            }
        }

        async function searchDrama() {
            const query = document.getElementById('searchInput').value.trim();
            if (!query) return alert('Masukkan kata kunci!');
            showLoading();

            try {
                const res = await fetch(`${API_BASE}/search?query=${encodeURIComponent(query)}`);
                const data = await res.json();
                const dramas = data.data || data;
                if (Array.isArray(dramas) && dramas.length > 0) {
                    displayDramas(dramas);
                } else {
                    showEmpty('Tidak ada hasil');
                }
            } catch (e) {
                showError('Gagal mencari: ' + e.message);
            }
        }

        async function loadDetail(bookId) {
            document.getElementById('modal').style.display = 'block';
            document.body.style.overflow = 'hidden';
            document.getElementById('modalContent').innerHTML = `
                <button class="close-btn" onclick="closeModal()">√ó</button>
                <div class="loading"><div class="spinner"></div><p>Memuat...</p></div>
            `;

            try {
                const [detailRes, epRes] = await Promise.all([
                    fetch(`${API_BASE}/detail?bookId=${bookId}`),
                    fetch(`${API_BASE}/episodes?bookId=${bookId}`)
                ]);
                const detailData = await detailRes.json();
                const epData = await epRes.json();

                if (detailData.data) displayDetail(detailData.data, epData.data || []);
            } catch (e) {
                showDetailError('Error: ' + e.message);
            }
        }

        function displayDramas(dramas) {
            let html = '<div class="drama-grid">';
            dramas.forEach(d => {
                const img = d.coverUrl || d.cover || 'https://via.placeholder.com/200x300/667eea/fff?text=No+Image';
                html += `
                    <div class="drama-card" onclick="loadDetail('${d.bookId || d.id}')">
                        <img src="${img}" onerror="this.src='https://via.placeholder.com/200x300'" loading="lazy">
                        <div class="drama-info">
                            <div class="drama-title">${d.bookName || d.title || 'Untitled'}</div>
                            <div class="drama-meta">‚≠ê ${d.score || 'N/A'}</div>
                            ${d.episodeNum ? `<div class="badge">${d.episodeNum} EP</div>` : ''}
                        </div>
                    </div>
                `;
            });
            html += '</div>';
            document.getElementById('content').innerHTML = html;
        }

        function displayDetail(drama, episodes) {
            const img = drama.coverUrl || drama.cover || '';
            const title = drama.bookName || drama.title || 'Untitled';
            const desc = drama.description || drama.introduction || '-';
            
            let epsHtml = '';
            if (episodes?.length) {
                epsHtml = `
                    <div class="section-title">üì∫ Episode</div>
                    <div class="episode-grid">
                        ${episodes.map((ep, i) => `
                            <button class="episode-btn" onclick="playEpisode('${ep.playUrl || ep.url}', ${i})">
                                EP ${ep.episodeNum || i+1}
                            </button>
                        `).join('')}
                    </div>
                `;
            }

            document.getElementById('modalContent').innerHTML = `
                <button class="close-btn" onclick="closeModal()">√ó</button>
                <div class="detail-header" style="background-image: linear-gradient(rgba(0,0,0,0.3), rgba(0,0,0,0.3)), url('${img}')">
                    <div class="detail-overlay">
                        <div class="detail-title">${title}</div>
                        <div class="detail-stats">
                            <span class="stat-item">‚≠ê ${drama.score || 'N/A'}</span>
                            <span class="stat-item">üì∫ ${drama.episodeNum || episodes.length} EP</span>
                        </div>
                    </div>
                </div>
                <div class="detail-body">
                    <div class="video-container" id="videoContainer">
                        <div class="video-player" id="videoPlayer"></div>
                    </div>
                    <div class="info-box">
                        <div class="info-label">üìù Sinopsis</div>
                        <div class="info-value">${desc}</div>
                    </div>
                    ${epsHtml}
                </div>
            `;
        }

        function playEpisode(url, index) {
            document.querySelectorAll('.episode-btn').forEach((b, i) => {
                b.classList.toggle('active', i === index);
            });
            const container = document.getElementById('videoContainer');
            const player = document.getElementById('videoPlayer');
            container.style.display = 'block';
            player.innerHTML = `<iframe src="${url}" allowfullscreen></iframe>`;
            container.scrollIntoView({ behavior: 'smooth' });
        }

        function closeModal() {
            document.getElementById('modal').style.display = 'none';
            document.body.style.overflow = 'auto';
        }

        function showLoading() {
            document.getElementById('content').innerHTML = `<div class="loading"><div class="spinner"></div><p>Memuat...</p></div>`;
        }

        function showError(msg) {
            document.getElementById('content').innerHTML = `<div class="loading" style="color:var(--danger)">‚ùå ${msg}</div>`;
        }

        function showEmpty() {
            document.getElementById('content').innerHTML = `<div class="loading">üì≠ Tidak ada drama</div>`;
        }

        function showDetailError(msg) {
            document.getElementById('modalContent').innerHTML = `<button class="close-btn" onclick="closeModal()">√ó</button><div class="loading" style="color:var(--danger)">‚ùå ${msg}</div>`;
        }
    </script>
</body>
</html>
